# ESP32-A1S-AudioKit 音频延迟器项目 - 软件需求文档

## 目标

构建一个基于 AI Thinker ESP32-A1S-AudioKit、EC11 编码器和 0.96-1306-IIC 128x64px OLED 显示屏的音频延迟器，支持音频输入延迟控制和采样率选择功能。

## 硬件基础

- **AI Thinker ESP32-A1S-AudioKit V2.2 974**：
  集成 ES8388 音频编解码器，支持单声道音频输入输出。
- **EC11 编码器模块**：
  带按压功能的旋转编码器，作为用户输入控制设备。EC11 旋钮编码器有 5 个 pin，GND, s1, s2, key 和 VCC。
- **0.96 英寸 OLED 显示屏**：
  0.96-1306-IIC, 128x64px 屏幕

## 功能需求

### 1. 音频延迟处理

- 默认延迟设置为 30ms，可通过旋钮进行调整。
- 最小延迟：0ms；最大延迟：10000ms（10 秒）。
- 延迟步进单位：1ms。
- 延迟时间精度：1ms。
- 默认采样率：192kHz
- 使用内存缓存音频数据实现延迟效果。
- 音频数据缓存使用双缓冲 FIFO 实现。

### 2. 用户输入控制（EC11）

- 旋转控制延迟时间或采样率选项。
- 按压确认选项选择。
- UI 交互中当前选择项颜色反转（例如背景白字黑，选中项带下划线）。

### 3. 显示界面（OLED）

- 实时显示当前延迟时间。
- 可切换采样率菜单（通过旋钮操作进入）。
- 选项反转显示，当前值带下划线表示已确认。

### 4. 采样率支持

- 采样率支持列表：44.1kHz, 48kHz, 96kHz, 192kHz。
- 采样率切换通过旋钮实现，按压确认。
- 启用动态切换采样率

### 5. 偏好设置

- 保存用户设置（延迟时间、采样率）到 NVS。
- 默认设置：延迟 30ms，采样率 48kHz。
- 支持重启后恢复用户设置
